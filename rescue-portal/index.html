<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#DC2626">
    <meta name="description" content="DRECS - H·ªá th·ªëng c·ª©u h·ªô kh·∫©n c·∫•p">
    
    <!-- PWA -->
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="assets/icons/icon-192.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="assets/icons/favicon.ico">
    
    <title>C·ª®U H·ªò KH·∫®N C·∫§P</title>
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        danger: '#DC2626',
                        primary: '#2563EB',
                        success: '#16A34A',
                        warning: '#F59E0B'
                    }
                }
            }
        }
    </script>
    
    <!-- Custom Styles -->
    <link rel="stylesheet" href="css/styles.css">
</head>
<body class="bg-gray-100 min-h-screen">
    
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <!-- SCREEN 1: MAIN FORM                                          -->
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div id="screen-main" class="screen active">
        <div class="min-h-screen flex flex-col p-4 max-w-lg mx-auto">
            
            <!-- Header -->
            <header class="text-center py-2">
                <h1 class="text-2xl font-bold text-gray-800">üÜò C·ª®U H·ªò KH·∫®N C·∫§P</h1>
                <p class="text-sm text-gray-600 mt-1" id="connection-status">
                    <span class="inline-block w-2 h-2 rounded-full bg-green-500 mr-1"></span>
                    ƒê√£ k·∫øt n·ªëi
                </p>
            </header>
            
            <!-- PANIC BUTTON -->
            <section class="flex-shrink-0 my-4">
                <button 
                    id="btn-panic" 
                    class="panic-button w-full bg-danger hover:bg-red-700 text-white font-bold text-2xl py-16 rounded-2xl shadow-lg transform transition-all active:scale-95"
                    onclick="handlePanic()"
                >
                    <div class="flex flex-col items-center">
                        <span class="text-5xl mb-2">üö®</span>
                        <span>C·∫¶N C·ª®U NGAY</span>
                        <span class="text-sm font-normal mt-2 opacity-80">Nh·∫•n n·∫øu r·∫•t kh·∫©n c·∫•p</span>
                    </div>
                </button>
            </section>
            
            <!-- Divider -->
            <div class="flex items-center my-4">
                <div class="flex-1 border-t border-gray-300"></div>
                <span class="px-4 text-gray-500 text-sm">HO·∫∂C ƒêI·ªÄN TH√îNG TIN</span>
                <div class="flex-1 border-t border-gray-300"></div>
            </div>
            
            <!-- RESCUE FORM -->
            <form id="rescue-form" class="space-y-4 flex-1" onsubmit="handleSubmit(event)">
                
                <!-- GPS Location -->
                <div class="form-group">
                    <label class="form-label">
                        <span class="text-xl mr-2">üìç</span> V·ªã tr√≠ c·ªßa b·∫°n
                    </label>
                    <div class="flex items-center gap-2">
                        <input 
                            type="text" 
                            id="input-location" 
                            class="form-input flex-1" 
                            placeholder="ƒêang l·∫•y v·ªã tr√≠..."
                            readonly
                        >
                        <button 
                            type="button" 
                            id="btn-gps" 
                            class="btn-secondary px-4 py-3"
                            onclick="refreshGPS()"
                        >
                            üîÑ
                        </button>
                    </div>
                    <input type="hidden" id="input-lat" name="lat">
                    <input type="hidden" id="input-lng" name="lng">
                    <p id="gps-error" class="text-red-500 text-sm mt-1 hidden"></p>
                </div>
                
                <!-- Number of People -->
                <div class="form-group">
                    <label class="form-label">
                        <span class="text-xl mr-2">üë•</span> S·ªë ng∆∞·ªùi c·∫ßn c·ª©u
                    </label>
                    <div class="grid grid-cols-4 gap-2">
                        <button type="button" class="select-btn" data-field="people" data-value="1">1</button>
                        <button type="button" class="select-btn" data-field="people" data-value="3">2-5</button>
                        <button type="button" class="select-btn" data-field="people" data-value="8">6-10</button>
                        <button type="button" class="select-btn" data-field="people" data-value="15">&gt;10</button>
                    </div>
                    <input type="hidden" id="input-people" name="people" required>
                </div>
                
                <!-- Urgency Level -->
                <div class="form-group">
                    <label class="form-label">
                        <span class="text-xl mr-2">üö®</span> M·ª©c ƒë·ªô kh·∫©n c·∫•p
                    </label>
                    <div class="grid grid-cols-3 gap-2">
                        <button type="button" class="select-btn" data-field="urgency" data-value="1">
                            <span class="block text-green-600">üü¢</span>
                            <span class="text-xs">Th·∫•p</span>
                        </button>
                        <button type="button" class="select-btn" data-field="urgency" data-value="2">
                            <span class="block text-yellow-500">üü°</span>
                            <span class="text-xs">Trung b√¨nh</span>
                        </button>
                        <button type="button" class="select-btn selected" data-field="urgency" data-value="3">
                            <span class="block text-red-600">üî¥</span>
                            <span class="text-xs">Kh·∫©n c·∫•p</span>
                        </button>
                    </div>
                    <input type="hidden" id="input-urgency" name="urgency" value="3">
                </div>
                
                <!-- Injured -->
                <div class="form-group">
                    <label class="form-label">
                        <span class="text-xl mr-2">ü©∫</span> C√≥ ng∆∞·ªùi b·ªã th∆∞∆°ng?
                    </label>
                    <div class="grid grid-cols-2 gap-2">
                        <button type="button" class="select-btn" data-field="injured" data-value="true">
                            <span class="text-red-600 font-bold">C√ì</span>
                        </button>
                        <button type="button" class="select-btn selected" data-field="injured" data-value="false">
                            <span class="text-green-600 font-bold">KH√îNG</span>
                        </button>
                    </div>
                    <input type="hidden" id="input-injured" name="injured" value="false">
                </div>
                
                <!-- Water Level -->
                <div class="form-group">
                    <label class="form-label">
                        <span class="text-xl mr-2">üåä</span> M·ª±c n∆∞·ªõc hi·ªán t·∫°i
                    </label>
                    <div class="grid grid-cols-4 gap-2">
                        <button type="button" class="select-btn" data-field="water_level" data-value="<0.5m">
                            <span class="block text-lg">ü¶∂</span>
                            <span class="text-xs">&lt;0.5m</span>
                        </button>
                        <button type="button" class="select-btn" data-field="water_level" data-value="0.5-1m">
                            <span class="block text-lg">ü¶µ</span>
                            <span class="text-xs">0.5-1m</span>
                        </button>
                        <button type="button" class="select-btn" data-field="water_level" data-value="1-2m">
                            <span class="block text-lg">üßç</span>
                            <span class="text-xs">1-2m</span>
                        </button>
                        <button type="button" class="select-btn" data-field="water_level" data-value=">2m">
                            <span class="block text-lg">üèä</span>
                            <span class="text-xs">&gt;2m</span>
                        </button>
                    </div>
                    <input type="hidden" id="input-water_level" name="water_level">
                </div>
                
                <!-- Food Available -->
                <div class="form-group">
                    <label class="form-label">
                        <span class="text-xl mr-2">üçö</span> C√≤n l∆∞∆°ng th·ª±c?
                    </label>
                    <div class="grid grid-cols-2 gap-2">
                        <button type="button" class="select-btn selected" data-field="food_available" data-value="true">
                            <span class="text-green-600 font-bold">C√íN</span>
                        </button>
                        <button type="button" class="select-btn" data-field="food_available" data-value="false">
                            <span class="text-red-600 font-bold">H·∫æT</span>
                        </button>
                    </div>
                    <input type="hidden" id="input-food_available" name="food_available" value="true">
                </div>
                
                <!-- Phone Number (Optional) -->
                <div class="form-group">
                    <label class="form-label">
                        <span class="text-xl mr-2">üìû</span> S·ªë ƒëi·ªán tho·∫°i <span class="text-gray-400 text-sm">(t√πy ch·ªçn)</span>
                    </label>
                    <input 
                        type="tel" 
                        id="input-phone" 
                        name="phone"
                        class="form-input" 
                        placeholder="VD: 0901234567"
                        pattern="[0-9]{10,11}"
                    >
                </div>
                
                <!-- Submit Button -->
                <button 
                    type="submit" 
                    id="btn-submit"
                    class="w-full bg-primary hover:bg-blue-700 text-white font-bold text-lg py-4 rounded-xl shadow-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed"
                >
                    G·ª¨I Y√äU C·∫¶U C·ª®U H·ªò
                </button>
                
            </form>
            
            <!-- Footer -->
            <footer class="text-center py-4 text-xs text-gray-400">
                DRECS v1.0 ‚Ä¢ H·ªá th·ªëng c·ª©u h·ªô kh·∫©n c·∫•p
            </footer>
            
        </div>
    </div>
    
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <!-- SCREEN 2: CONFIRMATION                                       -->
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div id="screen-confirm" class="screen">
        <div class="min-h-screen flex flex-col p-4 max-w-lg mx-auto">
            
            <!-- Success Icon -->
            <div class="flex-1 flex flex-col items-center justify-center text-center">
                <div class="w-24 h-24 bg-success rounded-full flex items-center justify-center mb-6 animate-bounce-once">
                    <span class="text-5xl text-white">‚úì</span>
                </div>
                
                <h1 class="text-2xl font-bold text-gray-800 mb-2">ƒê√É NH·∫¨N Y√äU C·∫¶U</h1>
                
                <div class="bg-gray-100 rounded-xl p-4 my-4 w-full">
                    <p class="text-gray-600 mb-1">M√£ c·ªßa b·∫°n:</p>
                    <p id="confirm-request-id" class="text-4xl font-bold text-primary">#----</p>
                    <p class="text-sm text-gray-500 mt-2">Gi·ªØ m√£ n√†y ƒë·ªÉ theo d√µi</p>
                </div>
                
                <!-- Request Summary -->
                <div class="bg-white rounded-xl p-4 w-full text-left shadow-sm">
                    <h3 class="font-semibold text-gray-700 mb-2">Th√¥ng tin ƒë√£ g·ª≠i:</h3>
                    <div class="space-y-1 text-sm">
                        <p><span class="text-gray-500">üìç V·ªã tr√≠:</span> <span id="confirm-location">--</span></p>
                        <p><span class="text-gray-500">üë• S·ªë ng∆∞·ªùi:</span> <span id="confirm-people">--</span></p>
                        <p><span class="text-gray-500">üö® M·ª©c ƒë·ªô:</span> <span id="confirm-urgency">--</span></p>
                        <p><span class="text-gray-500">üïê Th·ªùi gian:</span> <span id="confirm-time">--</span></p>
                    </div>
                </div>
                
                <!-- Waiting Status -->
                <div class="mt-6 p-4 bg-blue-50 rounded-xl w-full">
                    <div class="flex items-center justify-center">
                        <div class="spinner mr-3"></div>
                        <span class="text-primary">ƒêang ch·ªù ph·∫£n h·ªìi t·ª´ trung t√¢m...</span>
                    </div>
                </div>
                
            </div>
            
            <!-- Action Buttons -->
            <div class="space-y-3 pb-4">
                <button 
                    onclick="showScreen('main')" 
                    class="w-full bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-3 rounded-xl transition-all"
                >
                    ‚Üê G·ª≠i y√™u c·∫ßu m·ªõi
                </button>
            </div>
            
        </div>
    </div>
    
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <!-- SCREEN 3: RESPONSE                                           -->
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div id="screen-response" class="screen">
        <div class="min-h-screen flex flex-col p-4 max-w-lg mx-auto">
            
            <div class="flex-1 flex flex-col">
                
                <!-- Header -->
                <div class="text-center py-4">
                    <span class="text-5xl">üì¢</span>
                    <h1 class="text-2xl font-bold text-gray-800 mt-2">TH√îNG B√ÅO C·ª®U H·ªò</h1>
                    <p class="text-sm text-gray-500">M√£: <span id="response-request-id">#----</span></p>
                </div>
                
                <!-- Response Content -->
                <div class="flex-1">
                    
                    <!-- ETA Card -->
                    <div id="response-eta-card" class="bg-success text-white rounded-2xl p-6 mb-4 shadow-lg">
                        <div class="text-center">
                            <p class="text-lg opacity-90">ƒê·ªôi c·ª©u h·ªô s·∫Ω ƒë·∫øn trong</p>
                            <p class="text-5xl font-bold my-2" id="response-eta">~90</p>
                            <p class="text-xl">ph√∫t</p>
                        </div>
                        <div class="mt-4 pt-4 border-t border-white/30 flex justify-around text-center">
                            <div>
                                <p class="text-sm opacity-80">Ph∆∞∆°ng ti·ªán</p>
                                <p class="font-semibold" id="response-vehicle">üö§ Xu·ªìng</p>
                            </div>
                            <div>
                                <p class="text-sm opacity-80">H∆∞·ªõng ƒë·∫øn</p>
                                <p class="font-semibold" id="response-direction">T·ª´ ph√≠a ƒê√¥ng</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Instructions -->
                    <div class="bg-warning/10 rounded-2xl p-4 mb-4">
                        <h3 class="font-bold text-warning flex items-center mb-3">
                            <span class="text-xl mr-2">‚ö†Ô∏è</span> H∆Ø·ªöNG D·∫™N
                        </h3>
                        <ul id="response-instructions" class="space-y-2 text-gray-700">
                            <li class="flex items-start">
                                <span class="mr-2">‚Ä¢</span>
                                <span>Di chuy·ªÉn l√™n v·ªã tr√≠ cao nh·∫•t c√≥ th·ªÉ</span>
                            </li>
                            <li class="flex items-start">
                                <span class="mr-2">‚Ä¢</span>
                                <span>Chu·∫©n b·ªã √°o phao n·∫øu c√≥</span>
                            </li>
                            <li class="flex items-start">
                                <span class="mr-2">‚Ä¢</span>
                                <span>Gi·ªØ ƒëi·ªán tho·∫°i c√≤n pin</span>
                            </li>
                        </ul>
                    </div>
                    
                    <!-- Status Message -->
                    <div id="response-status" class="bg-blue-50 rounded-xl p-4 text-center">
                        <p class="text-primary" id="response-message">ƒê·ªôi ƒëang tr√™n ƒë∆∞·ªùng ƒë·∫øn</p>
                    </div>
                    
                </div>
                
            </div>
            
            <!-- Action Buttons -->
            <div class="space-y-3 pb-4">
                <button 
                    onclick="confirmReceived()" 
                    class="w-full bg-success hover:bg-green-700 text-white font-bold py-4 rounded-xl transition-all"
                >
                    ‚úì ƒê√É HI·ªÇU
                </button>
                <button 
                    onclick="requestMoreHelp()" 
                    class="w-full bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-3 rounded-xl transition-all"
                >
                    C·∫ßn h·ªó tr·ª£ th√™m
                </button>
            </div>
            
        </div>
    </div>
    
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <!-- OFFLINE NOTICE                                               -->
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div id="offline-notice" class="fixed top-0 left-0 right-0 bg-warning text-white text-center py-2 text-sm transform -translate-y-full transition-transform z-50">
        ‚ö†Ô∏è Kh√¥ng c√≥ m·∫°ng - Y√™u c·∫ßu s·∫Ω ƒë∆∞·ª£c g·ª≠i khi c√≥ k·∫øt n·ªëi
    </div>
    
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <!-- LOADING OVERLAY                                              -->
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div id="loading-overlay" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-2xl p-8 text-center">
            <div class="spinner-large mx-auto mb-4"></div>
            <p class="text-gray-700 font-semibold">ƒêang g·ª≠i y√™u c·∫ßu...</p>
        </div>
    </div>
    
    <!-- Scripts -->
    <script src="js/i18n.js"></script>
    <script src="js/storage.js"></script>
    <script src="js/gps.js"></script>
    <script src="js/api.js"></script>
    <script src="js/screens.js"></script>
    <script src="js/form.js"></script>
    <script src="js/app.js"></script>
    
    <!-- Register Service Worker -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js')
                    .then(reg => console.log('SW registered:', reg.scope))
                    .catch(err => console.log('SW registration failed:', err));
            });
        }
    </script>
    
</body>
</html>
